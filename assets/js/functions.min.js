"use strict";function debounce(e,t){var n=void 0;return function(){var a=this,r=arguments;return clearTimeout(n),n=setTimeout(function(){return e.apply(a,r)},t)}}function liveSearch(e){var t=[],n=new RegExp(e.split("").join("\\w*").replace(/\W/,""),"i");return events.forEach(function(e,a){e=Object.values(e).reduce(function(e,t){return e.concat(t)},[]),e.forEach(function(e){if(e.match(n))return t[a]=events[a]})}),0==t.length?t="Ничего не найдено":t.filter(function(e){return void 0!=e})}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function buildChangeEvent(e,t){var n=document.createElement("form");n.className="events__item event";var a=document.createElement("div");a.className="event__name",a.innerHTML=e.name;var r=document.createElement("div");r.className="event__date",r.innerHTML=e.date;var d=document.createElement("div");d.className="event__people",d.innerHTML=e.people.join(", ");var l=document.createElement("textarea");l.className="event__description",""==e.description||void 0==e.description?l.placeholder="Описание":l.value=e.description;var i=document.createElement("button");i.className="event__button",i.type="submit",i.innerHTML="Готово";var o=document.createElement("button");o.className="event__button",o.type="reset",o.innerHTML="Удалить",n.appendChild(a),n.appendChild(r),n.appendChild(d),n.appendChild(l),n.appendChild(i),n.appendChild(o),document.getElementById("events").appendChild(n),n.addEventListener("submit",function(t){t.preventDefault(),e.description=this.getElementsByTagName("textarea")[0].value})}function buildAddEvent(e){var t=document.createElement("form");t.className="events__item event";var n=document.createElement("fieldset");n.className="events__fieldset";var a=document.createElement("input");a.className="event__name",a.placeholder="Событие";var r=document.createElement("input");r.className="event__people",r.placeholder="Участники";var d=document.createElement("textarea");d.className="event__description",d.placeholder="Описание";var l=document.createElement("button");l.className="event__button",l.type="submit",l.innerHTML="Готово";var i=document.createElement("button");i.className="event__button",i.type="reset",i.innerHTML="Удалить",n.appendChild(a),n.appendChild(r),n.appendChild(d),t.appendChild(n),t.appendChild(l),t.appendChild(i),document.getElementById("events").appendChild(t),t.addEventListener("submit",function(t){t.preventDefault();var n=[].concat(_toConsumableArray(this.getElementsByTagName("fieldset")[0].elements)).map(function(e){return e=e.value});events.push({date:e.dataset.date,name:n[0],people:n[1].split(","),description:n[2]}),updateCalendar(events[events.length-1],events.length-1,e)})}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function createCalendar(e){document.querySelector(".timeline__content").innerHTML="";var t=new Date(formattedDate(e));t.setMonth(t.getMonth()-1),t=t.toLocaleDateString("ru-ru");for(var n=daysInMonth(t),a=new Date(new Date(formattedDate(e)).getFullYear(),new Date(formattedDate(e)).getMonth(),0).getDay(),r=0;r<a;r++){var d=document.createElement("div");d.className="timeline__day";var l=document.createElement("div");l.className="timeline__day-text",l.innerHTML=n-a+1+r,d.dataset.date=new Date(new Date(formattedDate(t)).getFullYear(),new Date(formattedDate(t)).getMonth(),n-a+1+r).toLocaleDateString("ru-ru"),d.appendChild(l),document.getElementById("timeline").appendChild(d)}for(var i=daysInMonth(e),o=1;o<=i;o++){var c=document.createElement("div");c.className="timeline__day";var m=document.createElement("div");m.className="timeline__day-text",m.innerHTML=o,c.dataset.date=new Date(new Date(formattedDate(e)).getFullYear(),new Date(formattedDate(e)).getMonth(),o).toLocaleDateString("ru-ru"),c.appendChild(m),document.getElementById("timeline").appendChild(c)}var s=new Date(formattedDate(e));s.setMonth(s.getMonth()+1),s=s.toLocaleDateString("ru-ru");for(var u=daysInMonth(s),v=42-i-a,p=0;p<v;p++){var h=document.createElement("div");h.className="timeline__day";var f=document.createElement("div");f.className="timeline__day-text",f.innerHTML=p+1,h.dataset.date=new Date(new Date(formattedDate(s)).getFullYear(),new Date(formattedDate(s)).getMonth(),p+1).toLocaleDateString("ru-ru"),h.appendChild(f),document.getElementById("timeline").appendChild(h)}var g=new Object;[].concat(_toConsumableArray(document.querySelectorAll(".timeline__day"))).forEach(function(e){g[e.dataset.date]=e});var E=new Array;events.forEach(function(e,t){void 0===E[e.date]&&(E[e.date]=[]),E[e.date].push(e)}),Object.keys(E).forEach(function(e){E[e].forEach(function(e,t){void 0!==g[e.date]&&updateCalendar(e,t,g[e.date])}),delete g[e]});for(var _ in g)g[_].addEventListener("click",function(){document.getElementById("events").innerHTML="",buildAddEvent(this),giglet=!1})}function updateCalendar(e,t,n){var a=document.createElement("div");a.className="timeline__day-content";var r=document.createElement("div");r.className="timeline__day-name",r.innerHTML=e.name;var d=document.createElement("div");d.className="timeline__day-people",d.innerHTML=e.people.join(", "),a.appendChild(r),a.appendChild(d),n.appendChild(a),n.addEventListener("click",function(){giglet?giglet!=e.date&&(document.getElementById("events").innerHTML=""):(document.getElementById("events").innerHTML="",giglet=this.dataset.date),buildChangeEvent(e,t)})}var settings={},events=[{date:"05.12.2017",name:"Напиться",people:["Витя Костин","Петр Михайлов"],description:""},{date:"03.12.2017",name:"Пойти гулять",people:["Петр Иванов","Иван Петров"],description:"Гулять по набережной"},{date:"03.12.2017",name:"Отправиться в путешествие",people:["Петр Иванов","Иван Петров"],description:"На Алтай"},{date:"02.12.2017",name:"Ужин в ресторане",people:["Костя Петров"],description:"Венеция"}],search=document.getElementById("search");search.addEventListener("keyup",debounce(function(){if(0!=this.value.length&&/\S/.test(this.value)){document.getElementById("result").innerHTML="";var e=liveSearch(this.value);if("string"==typeof e){var t=document.createElement("div");t.className="result__item";var n=document.createElement("div");n.className="result__item-message",n.innerHTML=e,t.appendChild(n),document.getElementById("result").appendChild(t)}else e.forEach(function(e){createResultItem(e.name,e.date)})}},400));var createResultItem=function e(t,n){var a=document.createElement("div");a.className="result__item";var r=document.createElement("div");r.className="result__item-name",r.innerHTML=t,a.appendChild(r);var d=document.createElement("div");d.className="result__item-date",d.innerHTML=n,a.appendChild(d),document.getElementById("result").appendChild(a)},addEventForm=document.getElementById("addEvent");addEventForm.addEventListener("submit",function(e){e.preventDefault();var t=[].concat(_toConsumableArray(this.getElementsByTagName("fieldset")[0].elements)).map(function(e){return e=e.value});events.push({date:t[1].split("-").reverse().join("."),name:t[0],people:t[2].split(","),description:t[3]}),createCalendar(selectedDate)});var addFastEventForm=document.getElementById("addFastEvent");addFastEventForm.addEventListener("submit",function(e){e.preventDefault();var t=[].concat(_toConsumableArray(this.getElementsByTagName("fieldset")[0].elements)).map(function(e){return e=e.value});events.push({date:t[0].split(";")[0],name:t[0].split(";")[1],people:t[0].split(";")[2].split(","),description:t[0].split(";")[3]}),createCalendar(selectedDate)});var formattedDate=function e(t){return t.split(".").reverse().join("-")},daysInMonth=function e(t){return new Date(new Date(formattedDate(t)).getFullYear(),new Date(formattedDate(t)).getMonth()+1,0).getDate()},monthName=function e(t){return new Date(formattedDate(t)).toLocaleDateString("ru-ru",{month:"long"})},thisDate=(new Date).toLocaleDateString("ru-ru"),selectedDate=thisDate;createCalendar(selectedDate);var giglet=!1;document.querySelector(".timeline__prev").onclick=function(){var e=new Date(formattedDate(selectedDate));e.setMonth(e.getMonth()-1),selectedDate=e.toLocaleDateString("ru-ru"),createCalendar(selectedDate)},document.querySelector(".timeline__next").onclick=function(){var e=new Date(formattedDate(selectedDate));e.setMonth(e.getMonth()+1),selectedDate=e.toLocaleDateString("ru-ru"),createCalendar(selectedDate)};